<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>$TRUST Price Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #0f0f1a; color: #fff; text-align: center; padding: 20px; }
    .container { max-width: 1000px; margin: auto; }
    .price-box { font-size: 4rem; font-weight: bold; margin: 20px 0; }
    .change-positive { color: #00ff9d; }
    .change-negative { color: #ff0066; }
    .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
    .card { background: #1a1a2e; padding: 20px; border-radius: 12px; }
    #chart { height: 400px; margin: 40px 0; background: #16213e; border-radius: 12px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>$TRUST Live Price Tracker</h1>
    <p id="last-updated">Loading...</p>

    <div class="price-box">
      $<span id="price">--</span>
      <span id="change" style="font-size: 1.5rem;">--</span>
    </div>

    <div class="info-grid">
      <div class="card">
        <h3>Market Cap</h3>
        <p id="market-cap">--</p>
      </div>
      <div class="card">
        <h3>24h Volume</h3>
        <p id="volume">--</p>
      </div>
      <div class="card">
        <h3>Circulating Supply</h3>
        <p id="supply">--</p>
      </div>
      <div class="card">
        <h3>24h High / Low</h3>
        <p id="high-low">-- / --</p>
      </div>
    </div>

    <div id="chart"></div>
  </div>

  <script>
    // Change this if $TRUST is on another chain or has a different Coingecko ID
    const COINGECKO_ID = "trueusd"; // Common IDs: trueusd (TUSD), trust-wallet-token, etc.
    // You can find the correct ID here: https://api.coingecko.com/api/v3/coins/list

    const priceEl = document.getElementById("price");
    const changeEl = document.getElementById("change");
    const marketCapEl = document.getElementById("market-cap");
    const volumeEl = document.getElementById("volume");
    const supplyEl = document.getElementById("supply");
    const highLowEl = document.getElementById("high-low");
    const updatedEl = document.getElementById("last-updated");
    let chart;

    async function fetchPrice() {
      try {
        const res = await fetch(
          `https://api.coingecko.com/api/v3/simple/price?ids=${COINGECKO_ID}&vs_currencies=usd&include_market_cap=true&include_24hr_vol=true&include_24hr_change=true&include_last_updated_at=true`
        );
        const data = await res.json();
        const coin = data[COINGECKO_ID];

        priceEl.textContent = coin.usd.toLocaleString(undefined, {minimumFractionDigits: 4, maximumFractionDigits: 8});
        const change = coin.usd_24h_change.toFixed(2);
        changeEl.textContent = `${change > 0 ? "+" : ""}${change}%`;
        changeEl.className = change > 0 ? "change-positive" : "change-negative";

        // Full market data
        const details = await fetch(`https://api.coingecko.com/api/v3/coins/${COINGECKO_ID}?localization=false&tickers=false&market_data=true&community_data=false&developer_data=false&sparkline=true`);
        const full = await details.json();

        marketCapEl.textContent = "$" + full.market_data.market_cap.usd.toLocaleString();
        volumeEl.textContent = "$" + full.market_data.total_volume.usd.toLocaleString();
        supplyEl.textContent = Number(full.market_data.circulating_supply).toLocaleString() + " TRUST";
        highLowEl.innerHTML = `$${full.market_data.high_24h.usd.toFixed(4)}<br>$${full.market_data.low_24h.usd.toFixed(4)}`;

        updatedEl.textContent = "Updated: " + new Date().toLocaleString();

        // Update chart (last 30 days hourly)
        updateChart(full.market_data, full.image.large);
      } catch (e) {
        console.error(e);
        priceEl.textContent = "Error loading data";
      }
    }

    function updateChart(marketData, logo) {
      const prices = marketData.sparkline_in_7d.price.map((p, i) => ({
        time: Date.now()/1000 - (7*24*60*60) + (i*60*60),
        value: p
      }));

      if (!chart) {
        const chartElement = document.getElementById('chart');
        chart = LightweightCharts.createChart(chartElement, {
          width: chartElement.clientWidth,
          height: 400,
          layout: { backgroundColor: '#16213e', textColor: '#d1d4dc' },
          grid: { vertLines: { color: '#2a2e39' }, horzLines: { color: '#2a2e39' } },
          crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
          rightPriceScale: { borderColor: '#2a2e39' },
          timeScale: { borderColor: '#2a2e39' },
        });

        const lineSeries = chart.addLineSeries({
          color: '#00ff9d',
          lineWidth: 2,
        });
        lineSeries.setData(prices);
      } else {
        // Just update data if chart exists
        chart.timeScale().fitContent();
      }
    }

    // Auto-refresh every 30 seconds
    fetchPrice();
    setInterval(fetchPrice, 30000);

    // Responsive chart
    window.addEventListener('resize', () => {
      if (chart) chart.applyOptions({ width: document.getElementById('chart').clientWidth });
    });
  </script>
</body>
</html>